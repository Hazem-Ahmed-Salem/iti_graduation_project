{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <h2>لوحة تحكم البائع</h2>

  <h4 class="mt-4">منتجاتك</h4>
  <div class="row">
    {% for product in products %}
    <div class="col-md-4">
      <div class="card mb-3">
        <img src="{{ product.thumbnail.url }}" class="card-img-top" style="height: 200px; object-fit: cover;">
        <div class="card-body">
          <h5>{{ product.name }}</h5>
          <p>السعر: {{ product.price }} جنيه</p>
          <a href="{% url 'edit_product' product.id %}" class="btn btn-warning btn-sm">تعديل</a>
          <a href="{% url 'delete_product' product.id %}" class="btn btn-danger btn-sm">حذف</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <h4 class="mt-5">طلبات على منتجاتك</h4>
  <ul class="list-group">
    {% for order in orders %}
      <li class="list-group-item">
        {{ order.product.name }} - {{ order.quantity }} قطعة - {{ order.created_at|date:"Y-m-d" }}
      </li>
    {% empty %}
      <li class="list-group-item">لا يوجد طلبات بعد</li>
    {% endfor %}
  </ul>

  <h4 class="mt-5">إحصائيات المبيعات</h4>
  <canvas id="salesChart" height="150"></canvas>
</div>

<!-- Chart.js -->
{{ labels|json_script:"labels-data" }}
{{ data|json_script:"sales-data" }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = JSON.parse(document.getElementById('labels-data').textContent);
  const data = JSON.parse(document.getElementById('sales-data').textContent);

  const ctx = document.getElementById('salesChart');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'عدد القطع المباعة',
        data: data,
        backgroundColor: 'rgba(54, 162, 235, 0.6)',
        borderWidth: 1
      }]
    }
  });
</script>

{% endblock %}
